<!DOCTYPE>
<html>

<head lang="zh">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>正在加载游戏，请稍候...</title>
    <script src="https://login.powerplay88.com/jswrapper/integration.js.php?casino=powerplay88"></script>
</head>

<body>
    <h3>正在进入游戏，请稍候.....</h3>
    <script>
        window.onload = function () {
            // debugger
            
            // console.log(GetQueryString("_1"), GetQueryString("_2"),GetQueryString("_3"));
            iapiSetClientPlatform("mobile&deliveryPlatform=HTML5");

            iapiSetCallout('Login', callback_Login);
            iapiSetCallout('Logout', callback_Logout);
            iapiSetCallout('GetTemporaryAuthenticationToken', callback_Token);

            iapiLogin(decodeURIComponent(GetQueryString("_2")), decodeURIComponent(GetQueryString("_3")), "1", "zh-cn");

            // setTimeout(function(){
            //     location.href = decodeURIComponent(GetQueryString("_1"))
            // },2000*1)


        }

        function callback_Token(response) {
            if (response.errorCode) {
                alert("Token failed. " + response.playerMessage + " Error code: " + response.errorCode);
            }
            else {
                // launchMobileClient(response.sessionToken.sessionToken);
                var gotoURL = decodeURIComponent(GetQueryString("_1"));

                gotoURL += "&username=" + decodeURIComponent(GetQueryString("_2")) + 
                "&tempToken=" + response.sessionToken.sessionToken+
                '&lobby=' + location.origin + '/eplatform/15/home' + 
                '&support=' + location.origin + '/contactus'+
                '&logout=' + location.origin + '/eplatform/15/home'+
                '&deposit=' + location.origin + '/deposit';
                console.log(gotoURL)

                location.href = gotoURL;
            }

        }
        function callback_Login(response) {
            if (response.errorCode) {
                console.log("Login failed, " + response.errorText);
                alert("Login failed. " + response.playerMessage + " Error code: " + response.errorCode);
            } else {
                // location.href = decodeURIComponent(GetQueryString("_1"))
                iapiRequestTemporaryToken(1, '424', 'GamePlay');
            }
        }
        function callback_Logout(response) {
            if (response.errorCode) {
                //alert("Logout failed, " + response.errorCode);
            }
        }
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
    </script>
</body>

</html>